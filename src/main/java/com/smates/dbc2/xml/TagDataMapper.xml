<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smates.dbc2.mapper.TagDataDao">

	<resultMap type="TagLocationData" id="getAllLocationMap">
		<id column="tagNum" property="tagNum" />
		<result column="startDate" property="startDate" />
		<result column="start" property="start" />
		<result column="Name" property="name" />
		<result column="Sex" property="sex" />
		<result column="Age" property="age" />
		<result column="MaritalStatus" property="maritalStatus" />
		<result column="roomNum" property="roomNum" />
		<result column="roomName" property="roomName" />
		<result column="end" property="end" />
		<result column="endDate" property="endDate" />
	</resultMap>

<!-- 查询所有标签的定位信息，顺便查出标签基本信息 -->
	<select id="getAllLocation" resultMap="getAllLocationMap">
		select
		ti1.tagNum,t03.startDate,t03.start,ti1.Name,ti1.Sex,ti1.Age,ti1.MaritalStatus,t03.roomNum,t03.roomName
		,t03.end,t03.endDate
		from TagInformation ti1 left join (select
		t01.tagNum,t01.startDate,t01.start,t01.end,t01.endDate,ri1.roomNum,ri1.roomName
		from time t01,
		(SELECT max(id) AS max_id,tagNum FROM time GROUP BY tagNum) t02
		,RoomInformation ri1
		where t01.id=t02.max_id AND t01.cpid = ri1.cpid AND t01.wakeupNum =
		ri1.wakeupNum ) t03 on ti1.TagNum=t03.tagNum
		where ti1.Usefull = 'true'
		order by ti1.tagNum 
	</select>

</mapper>